---
title: "Assignment_02"
author: "NickyNie"
date: "10/4/2021"
output: 
  - html_document
  - github_document
always_allow_html: true
---

```{r setup, include=FALSE, cache = TRUE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(data.table)
library(dplyr)
```

# Data Wrangling
## Download data
```{r download}
ind <- fread("chs_individual.csv")
reg <- fread("chs_regional.csv")
```

## Merge datasets
```{r merge}
data <- merge(
  x = ind,
  y = reg,
  by ="townname",
  all.x = TRUE,
  all.y = FALSE
)
```

## Checking duplications
```{r row_nuumber}
dim(ind)
dim(reg)
dim(data)
```
No duplication

## Impute NAs
The key variables are bmi, fev, asthma, smoke pm2.5 mass and gasstove, check for NAs
```{r check_NAs}
sum(is.na(data$bmi))
sum(is.na(data$fev))
sum(is.na(data$smoke))
sum(is.na(data$gasstove))
sum(is.na(data$asthma))
sum(is.na(data$pm25_mass))
```

```{r impute}
data[, m_bmi := mean(bmi, na.rm = TRUE), by = .(male, hispanic)]
data[, bmi := ifelse(is.na(bmi), m_bmi, bmi)]
data[, m_fev := mean(fev, na.rm = TRUE), by = .(male, hispanic)]
data[, fev := ifelse(is.na(fev), m_fev, fev)]
data[, m_smoke := mean(smoke, na.rm = TRUE), by = .(male, hispanic)]
data[, smoke := ifelse(is.na(smoke), m_smoke, smoke)]
data[, m_gas := mean(gasstove, na.rm = TRUE), by = .(male, hispanic)]
data[, gasstove := ifelse(is.na(gasstove), m_gas, gasstove)]
data[, m_asthma := mean(asthma, na.rm = TRUE), by = .(male, hispanic)]
data[, asthma := ifelse(is.na(asthma), m_asthma, asthma)]
sum(is.na(data$bmi))
sum(is.na(data$fev))
sum(is.na(data$smoke))
sum(is.na(data$gasstove))
sum(is.na(data$asthma))
```

## Create obesity level variable using BMI measurement
```{r BMI}
data <- data[, obesity_level := fifelse(bmi<14, "Underweight",
                                    fifelse(bmi >= 14  & bmi < 22, "Normal",
                                        fifelse(bmi >= 22 & bmi < 24,"Overweight","Obesity")))]
```

knit a table
```{r table}
tab <- data[, .(
  Max_BMI = max(bmi),
  Min_BMI = min(bmi),
  Total_Number = .N
), by = obesity_level]

knitr::kable(tab)
```

## Create smoke-gas-exposure variable
```{r smoke_gas_exposure}
data <- data[, smoke_gas_exposure := fifelse(smoke == 0 & gasstove == 0, "No_Exposure",
                                          fifelse(smoke == 1 & gasstove == 0, "Smoke_Exposure",
                                              fifelse(smoke == 0 & gasstove == 1, "Gas_Exposure","Both_Exposure")))]
```

table of town
```{r}
tab <- data[, .(
  avg_fev = mean(fev),
  sd_fev = sd(fev),
  avg_asthma = mean(asthma),
  sd_asthma = sd(asthma)
), by = townname]

knitr::kable(tab)
```

table of sex
```{r}
tab <- data[, .(
  avg_fev = mean(fev),
  sd_fev = sd(fev),
  avg_asthma = mean(asthma),
  sd_asthma = sd(asthma)
), by = male]

knitr::kable(tab)
```

table of obesity level
```{r}
tab <- data[, .(
  avg_fev = mean(fev),
  sd_fev = sd(fev),
  avg_asthma = mean(asthma),
  sd_asthma = sd(asthma)
), by = obesity_level]

knitr::kable(tab)
```

table of smoke_gas_exposure
```{r}
tab <- data[, .(
  avg_fev = mean(fev),
  sd_fev = sd(fev),
  avg_asthma = mean(asthma),
  sd_asthma = sd(asthma)
), by = smoke_gas_exposure]

knitr::kable(tab)
```

# Looking at the data
check for dimension
```{r dim}
dim(data)
```

headers and footers
```{r headers}
head(data)
```



```{r footer}
tail(data)
```

variable
```{r variable}
str(data)
```
key variable
```{r key}
summary(data$fev)
summary(data$bmi)
summary(data$smoke_gas_exposure)
summary(data$pm25_mass)
```

